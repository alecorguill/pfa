package neoblik;

import java.io.IOException;
import java.io.PrintWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.http.*;

import beans.Player;
import model.Players;
import form.FormPlayer;

public class ConnectSmartphone extends HttpServlet {

	public static final String VUE = "/WEB-INF/connect_smartphone.jsp";	
    public static final String CHAMP_PSEUDO = "pseudo";
	
	public void doGet( HttpServletRequest request, HttpServletResponse response )   throws ServletException, IOException {
		
		String message = "";
		request.setAttribute("message", message);
		this.getServletContext().getRequestDispatcher( VUE ).forward( request, response );
	}
	
    public void doPost( HttpServletRequest request, HttpServletResponse response ) throws ServletException, IOException{
        /* Traitement des donnÃ©es du formulaire */
    	String pseudo = request.getParameter( CHAMP_PSEUDO );
    	ServletContext context = this.getServletContext();
    	Players p = (Players) context.getAttribute("players");
    	
    	String message;
    	boolean isCorrect;
    	if(p.canConnect(pseudo)) {
    		isCorrect = true;
    		message = "Votre smartphone est connecté";
    		p.getPlayer(pseudo).setHasSmarphone(true);
    	}
    	
    	else {
    		isCorrect = false;
    		if(!p.alreadyIn(pseudo)) {
    			message = "Votre pseudo n'existe pas";
    		}
    		else {
    			message = "Un smartphone a déja été connecté pour ce pseudo";
    		}
    	}
    	
    	request.setAttribute("isCorrect", isCorrect);
		request.setAttribute("message", message);
    	
        this.getServletContext().getRequestDispatcher( VUE ).forward( request, response );
    	
    }
    
}